<div class="form-group mb-2" *ngIf="field.type !== 'API'">
  <ng-container *ngIf="type !== 'B'; else booleanField">

    <!-- AnnÃ©e -->
    <div *ngIf="type === 'Y'" class="w-100">
      <app-single-year-picker [formControl]="control"></app-single-year-picker>
      <mat-error *ngIf="submitted && control?.errors">
        <div *ngIf="control?.errors?.['required']">{{ label }} is required</div>
      </mat-error>
    </div>

    <!-- Upload de fichier -->
    <div *ngIf="type === 'F'" class="w-100">
      <div class="file-upload-container">
        <label class="custom-label d-block mb-2">
          {{ label }}
          <small class="text-muted ms-1" *ngIf="!field.obligatoire">(Facultatif)</small>
        </label>

        <input
          type="file"
          class="file-input"
          [attr.accept]="'*'"
          (change)="onFileSelected($event)"
        />

        <!-- Afficher le nom du fichier sÃ©lectionnÃ© -->
        <div *ngIf="selectedFileName" class="mt-2 text-sm text-muted">
          ðŸ“Ž {{ selectedFileName }}
        </div>

        <mat-error *ngIf="submitted && control?.errors">
          <div *ngIf="control?.errors?.['required']">{{ label }} est requis</div>
        </mat-error>
      </div>
    </div>

    <!-- Switch -->
    <div *ngIf="type === 'S'">
      <mat-label>{{ label }}</mat-label>
      <mat-slide-toggle (change)="onToggleChange($event)">
        {{ control.value === 1 ? 'Oui' : 'Non' }}
      </mat-slide-toggle>
    </div>


        <!-- TextArea -->
    <div *ngIf="type === 'TTA'" class="w-100 text-area-block">
      <label class="custom-label d-block mb-1">
        {{ label }}
        <small class="text-muted ms-1">(Facultatif)</small>
      </label>
    
      <textarea
        matInput
        rows="5"
        [formControl]="control"
        [placeholder]="placeholder || label"
        class="custom-textarea w-100"
        [ngClass]="{ 'is-invalid': submitted && control?.errors }"
      ></textarea>
    
      <mat-error *ngIf="submitted && control?.errors">
        <div *ngIf="control?.errors?.['required']">{{ label }} est requis</div>
      </mat-error>
    </div>
    


    <!-- mat-form-field pour les types normaux sauf TT -->
    <mat-form-field *ngIf="type !== 'Y' && type !== 'TT' && type !== 'S' && type !== 'TTA' && type !=='F'"  appearance="outline" class="w-100">
      <mat-label>{{ label }}</mat-label>

      <ng-container [ngSwitch]="type">

        <!-- Currency -->
        <input *ngSwitchCase="'V'" matInput type="text" [formControl]="control" [placeholder]="placeholder || label"
          [ngClass]="{ 'is-invalid': submitted && control?.errors }" [value]="control?.value | number:'1.0-0'"
          (input)="onCurrencyInput($event)" />

        <!-- Email -->
        <!-- <input *ngSwitchCase="'R'" matInput [type]="field.options[0]?.value ? 'email' : 'text'" [formControl]="control"
          [placeholder]="placeholder || label" [ngClass]="{ 'is-invalid': submitted && control?.errors }" /> -->

        <!-- Date -->
        <ng-container *ngSwitchCase="'D'">
          <input matInput [matDatepicker]="picker" [formControl]="control" (dateChange)="onDateChange($event)"
            [placeholder]="placeholder || label">
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </ng-container>

        <!-- Autocomplete -->
        <ng-container *ngSwitchCase="'L'">
          <input type="text" matInput [formControl]="control" [placeholder]="placeholder || label"
            [matAutocomplete]="auto" (input)="valueChanged.emit(control.value)" />

          <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn.bind(this)">
            <mat-option *ngFor="let option of filteredOptions | async" [value]="option.value" (onSelectionChange)="
              $event.isUserInput && valueChanged.emit(option.value)">
              {{ option.label }}
            </mat-option>
          </mat-autocomplete>
        </ng-container>

            <!-- Password -->
            <ng-container *ngSwitchCase="'P'">

        <input matInput [type]="hidePassword ? 'password' : 'text'" [formControl]="control"
          [placeholder]="placeholder || label" [ngClass]="{ 'is-invalid': submitted && control?.errors }" />
        <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword"
          [attr.aria-label]="'Toggle password visibility'" type="button">
          <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
      </ng-container>

        <!-- Champ par dÃ©faut -->
        <input *ngSwitchDefault matInput [type]="type" [formControl]="control" [placeholder]="placeholder || label"
          [ngClass]="{ 'is-invalid': submitted && control?.errors }" />
      </ng-container>

      <mat-error *ngIf="submitted && control?.errors">
        <div *ngIf="control?.errors?.['required']">{{ label }} est requis</div>
        <div *ngIf="control?.errors?.['pattern']">
          {{ getPatternLabel(field) }}
        </div>
      </mat-error>
    </mat-form-field>


    
    
    <div *ngIf="type === 'TT'" class="w-100">
      <label>{{ label }}</label>
      <mat-button-toggle-group [formControl]="control" name="fontStyle" aria-label="Font Style">
        <mat-button-toggle *ngFor="let option of field.options" [value]="option.value">
          {{ option.label }}
        </mat-button-toggle>
      </mat-button-toggle-group>

      <mat-error *ngIf="submitted && control?.errors">
        <div *ngIf="control?.errors?.['required']">{{ label }} est requis</div>
      </mat-error>
    </div>
  </ng-container>

  <!-- Boolean -->
  <ng-template #booleanField>
    <mat-checkbox [formControl]="control" (change)="onCheckboxChange($event)">
      {{ label }}
    </mat-checkbox>
    <mat-error *ngIf="submitted && control?.errors">
      <div *ngIf="control?.errors?.['required']">{{ label }} is required</div>
    </mat-error>
  </ng-template>
</div>